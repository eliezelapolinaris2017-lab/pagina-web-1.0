<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NeoCatálogo — Galería editable</title>
<meta name="theme-color" content="#0b0f14">
<style>
:root{
  --bg:#0b0f14; --fg:#eaf2ff; --muted:#9db0c9; --primary:#5df0c1; --accent:#7aa5ff;
  --danger:#ff6b6b; --outline:rgba(255,255,255,.08); --glass:rgba(255,255,255,.06);
  --radius:18px; --shadow:0 20px 60px rgba(0,0,0,.45);
  --font: ui-sans-serif, system-ui, -apple-system, "SF Pro", Inter, Segoe UI, Roboto, Arial;
}
*{box-sizing:border-box}
body{margin:0; font-family:var(--font); color:var(--fg); background:var(--bg);}
a{color:inherit; text-decoration:none}
img{max-width:100%; display:block}
button{cursor:pointer; border:0; border-radius:12px; padding:.7rem 1rem; color:#fff;
  background:linear-gradient(135deg,var(--accent),var(--primary));}
.btn-ghost{background:transparent; border:1px solid var(--outline); color:var(--fg)}
.btn-danger{background:linear-gradient(135deg,#ff6b6b,#b92f2f)}
.input,select,textarea{width:100%; padding:.7rem .9rem; border:1px solid var(--outline);
  border-radius:12px; background:#111a22; color:#fff}
label{display:block; font-size:.85rem; color:var(--muted); margin:.2rem 0 .3rem}
.container{max-width:1180px; margin:0 auto; padding:24px 16px 80px}
.header{position:sticky; top:0; background:#0b0f14; border-bottom:1px solid var(--outline); z-index:10}
.header-inner{display:flex; gap:12px; align-items:center; padding:10px 16px;}
.brand{display:flex; align-items:center; gap:.6rem}
.brand .logo{width:36px; height:36px; border-radius:8px; border:1px solid var(--outline); object-fit:cover}
.nav{margin-left:auto; display:flex; gap:.4rem; flex-wrap:wrap}
.tab{padding:.4rem .8rem; border-radius:999px; border:1px solid var(--outline)}
.tab.active{background:var(--glass); border-color:transparent}
.screen{display:none}
.screen.active{display:block}
.card{background:var(--glass); border:1px solid var(--outline); border-radius:var(--radius); padding:1rem; margin-bottom:1rem}
.grid{display:grid; gap:1rem; grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
.item{display:flex; flex-direction:column; gap:.5rem}
.item img{width:100%; height:180px; object-fit:cover; border-radius:12px; border:1px solid var(--outline)}
.price{padding:.2rem .55rem; border-radius:10px; border:1px solid var(--outline); background:rgba(122,165,255,.1); font-size:.85rem}
.footer{border-top:1px solid var(--outline); text-align:center; padding:16px; color:#aaa}
.hidden{display:none !important}
</style>
</head>
<body>
<header class="header">
  <div class="header-inner">
    <div class="brand">
      <img id="brandLogo" class="logo" alt="logo">
      <div>
        <div id="brandName">NeoCatálogo</div>
        <div id="brandSub" style="font-size:.85rem;color:#aaa">Galería editable</div>
      </div>
    </div>
    <nav class="nav">
      <a class="tab active" data-goto="screen-home">Inicio</a>
      <a class="tab" data-goto="screen-tab2">Pestaña 2</a>
      <a class="tab" data-goto="screen-tab3">Pestaña 3</a>
      <a class="tab" data-goto="screen-config">Configuración</a>
    </nav>
    <div class="toolbar">
      <button id="btnLogin" class="btn-ghost">Login</button>
      <button id="btnLogout" class="btn-danger hidden">Salir</button>
    </div>
  </div>
</header>

<main class="container">
  <!-- HOME -->
  <section id="screen-home" class="screen active">
    <div class="card">
      <div class="toolbar">
        <h2>Página principal</h2>
        <button id="btnAddItemHome" class="btn-ghost hidden">Añadir ítem</button>
        <button id="btnExportPDFHome" class="btn-ghost">Exportar PDF</button>
      </div>
      <div id="customHtmlHome"></div>
      <div id="gridHome" class="grid"></div>
    </div>
  </section>

  <!-- TAB 2 -->
  <section id="screen-tab2" class="screen">
    <div class="card">
      <h2>Pestaña 2</h2>
      <button id="btnAddItemTab2" class="btn-ghost hidden">Añadir ítem</button>
      <div id="customHtmlTab2"></div>
      <div id="gridTab2" class="grid"></div>
    </div>
  </section>

  <!-- TAB 3 -->
  <section id="screen-tab3" class="screen">
    <div class="card">
      <h2>Pestaña 3</h2>
      <button id="btnAddItemTab3" class="btn-ghost hidden">Añadir ítem</button>
      <div id="customHtmlTab3"></div>
      <div id="gridTab3" class="grid"></div>
    </div>
  </section>

  <!-- CONFIGURACIÓN -->
  <section id="screen-config" class="screen">
    <div class="card">
      <h2>Configuración</h2>
      <label>Nombre</label><input id="cfg_name" class="input">
      <label>Subtítulo</label><input id="cfg_sub" class="input">
      <label>Logo</label><input id="cfg_logo" type="file" accept="image/*" class="input">
      <label>Color primario</label><input id="cfg_primary" type="color" class="input">
      <label>Color acento</label><input id="cfg_accent" type="color" class="input">
      <button id="btnApplyBrand">Aplicar branding</button>
      <hr>
      <label>Facebook</label><input id="cfg_fb" class="input">
      <label>Instagram</label><input id="cfg_ig" class="input">
      <label>WhatsApp</label><input id="cfg_wa" class="input">
      <label>Texto WA</label><input id="cfg_wa_text" class="input">
      <button id="btnApplyLinks">Aplicar enlaces</button>
      <hr>
      <label>Inicio HTML</label><textarea id="cfg_html_home" class="input"></textarea>
      <label>Pestaña2 HTML</label><textarea id="cfg_html_tab2" class="input"></textarea>
      <label>Pestaña3 HTML</label><textarea id="cfg_html_tab3" class="input"></textarea>
      <button id="btnApplyHtml">Aplicar HTML</button>
    </div>
  </section>

  <!-- MODAL -->
  <div id="modal" class="hidden" style="position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center">
    <div class="card" style="max-width:600px;width:90%">
      <h3 id="modalTitle">Ítem</h3>
      <label>Título</label><input id="it_title" class="input">
      <label>Precio</label><input id="it_price" class="input" type="number">
      <label>Descripción</label><textarea id="it_desc" class="input"></textarea>
      <label>Imagen URL</label><input id="it_imgurl" class="input">
      <label>o Imagen archivo</label><input id="it_image" type="file" class="input" accept="image/*">
      <label>Enlace YouTube</label><input id="it_yt" class="input">
      <label>Link externo</label><input id="it_link" class="input">
      <label>WhatsApp</label><input id="it_wa" class="input">
      <button id="btnSaveItem">Guardar</button>
      <button id="btnDeleteItem" class="btn-danger hidden">Eliminar</button>
      <button id="btnCloseModal" class="btn-ghost">Cerrar</button>
    </div>
  </div>
</main>

<footer class="footer">© <span id="year"></span> <span id="footName">NeoCatálogo</span></footer>

<script>
/* ========= Claves de storage ========= */
const KEY={CFG:'neo_cfg',ITEMS:'neo_items',SESSION:'neo_session'};

/* ========= Helpers ========= */
const $=s=>document.querySelector(s),$$=s=>document.querySelectorAll(s),byId=id=>document.getElementById(id);
const load=(k,d)=>JSON.parse(localStorage.getItem(k)||JSON.stringify(d));
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const uuid=()=>Date.now().toString(36)+Math.random().toString(36).slice(2);
function fileToDataURL(f){return new Promise(r=>{const rd=new FileReader();rd.onload=()=>r(rd.result);rd.readAsDataURL(f);});}
const isAdmin=()=>!!load(KEY.SESSION,null);

/* ========= Defaults ========= */
function ensureDefaults(){
  if(!load(KEY.CFG)){
    save(KEY.CFG,{
      name:'NeoCatálogo',sub:'Galería editable',logo:null,
      primary:'#5df0c1',accent:'#7aa5ff',
      fb:'',ig:'',waPhone:'',waText:'Hola, me interesa este artículo.',
      htmlHome:'',htmlTab2:'',htmlTab3:''
    });
  }
  if(!load(KEY.ITEMS)) save(KEY.ITEMS,{home:[],tab2:[],tab3:[]});
}

/* ========= Branding ========= */
function applyBrand(){
  const c=load(KEY.CFG,{});
  byId('brandName').textContent=c.name||'';
  byId('brandSub').textContent=c.sub||'';
  byId('footName').textContent=c.name||'';
  byId('year').textContent=new Date().getFullYear();
  if(c.logo) byId('brandLogo').src=c.logo;
  document.documentElement.style.setProperty('--primary',c.primary||'#5df0c1');
  document.documentElement.style.setProperty('--accent', c.accent ||'#7aa5ff');
}

/* ========= Navegación ========= */
function show(id){
  $$('.screen').forEach(s=>s.classList.remove('active'));
  byId(id).classList.add('active');
  $$('.tab').forEach(t=>t.classList.remove('active'));
  $$(`[data-goto="${id}"]`).forEach(t=>t.classList.add('active'));
}

/* ========= Render tarjetas ========= */
function iconBtn(href,label){
  if(!href) return '';
  return `<a href="${href}" target="_blank" class="btn-ghost" style="display:inline-block;margin-top:.4rem;padding:.45rem .7rem;border-radius:10px;border:1px solid var(--outline)">${label}</a>`;
}
function waBtn(num,text){
  const phone=(num||'').replace(/\D/g,''); if(!phone) return '';
  const url=`https://wa.me/${phone}?text=${encodeURIComponent(text||'Hola')}`;
  return iconBtn(url,'WhatsApp');
}
function cardTpl(it){
  const cfg=load(KEY.CFG,{});
  const tools = [
    it.yt ? iconBtn(it.yt,'YouTube') : '',
    it.link ? iconBtn(it.link,'Enlace') : '',
    (it.wa||cfg.waPhone) ? waBtn((it.wa||cfg.waPhone),(cfg.waText||'Hola')) : ''
  ].join(' ');
  return `
  <div class="item card">
    ${it.img?`<img src="${it.img}" alt="">`:''}
    <b>${it.title||''}</b>
    ${it.price?`<span class="price">${it.price}</span>`:''}
    <div style="font-size:.95rem;color:#c6d6ef">${it.desc||''}</div>
    <div>${tools}</div>
    ${isAdmin()?`<div style="display:flex;gap:.4rem;margin-top:.5rem">
      <button class="btn-ghost" onclick="openModal('${it.id}','${it.tab}')">Editar</button>
      <button class="btn-danger" onclick="quickDelete('${it.id}','${it.tab}')">Eliminar</button>
    </div>`:''}
  </div>`;
}
function renderTab(tab){
  const data=load(KEY.ITEMS,{home:[],tab2:[],tab3:[]})[tab];
  const gridId=tab==='home'?'gridHome':(tab==='tab2'?'gridTab2':'gridTab3');
  const htmlId=tab==='home'?'customHtmlHome':(tab==='tab2'?'customHtmlTab2':'customHtmlTab3');
  // HTML libre
  const cfg=load(KEY.CFG,{});
  byId(htmlId).innerHTML = (tab==='home'?cfg.htmlHome:(tab==='tab2'?cfg.htmlTab2:cfg.htmlTab3)) || '';
  // Cards
  byId(gridId).innerHTML = (data.length? data.map(cardTpl).join('') : '<div class="help">Vacío</div>');
}
function renderAll(){ renderTab('home'); renderTab('tab2'); renderTab('tab3'); }

/* ========= Modal CRUD ========= */
let CURRENT_TAB='home',EDITING_ID=null;
function openModal(id=null,tab=CURRENT_TAB){
  CURRENT_TAB=tab; EDITING_ID=id;
  const list=load(KEY.ITEMS,{home:[],tab2:[],tab3:[]})[tab];
  const it=id?list.find(x=>x.id===id):{id:uuid(),tab};
  byId('modalTitle').textContent=id?'Editar ítem':'Nuevo ítem';
  byId('it_title').value=it.title||'';
  byId('it_price').value=it.price||'';
  byId('it_desc').value=it.desc||'';
  byId('it_imgurl').value=it.img||'';
  byId('it_yt').value=it.yt||'';
  byId('it_link').value=it.link||'';
  byId('it_wa').value=it.wa||'';
  byId('btnDeleteItem').classList.toggle('hidden',!id);
  byId('modal').classList.remove('hidden');
}
function closeModal(){ byId('modal').classList.add('hidden'); }
async function saveItem(){
  const items=load(KEY.ITEMS,{home:[],tab2:[],tab3:[]});
  const list=items[CURRENT_TAB];
  let img=byId('it_imgurl').value.trim();
  const f=byId('it_image').files?.[0];
  if(f) img=await fileToDataURL(f);
  const data={
    id:EDITING_ID||uuid(),
    tab:CURRENT_TAB,
    title:byId('it_title').value.trim(),
    price:byId('it_price').value.trim(),
    desc:byId('it_desc').value.trim(),
    img:img,
    yt:byId('it_yt').value.trim(),
    link:byId('it_link').value.trim(),
    wa:byId('it_wa').value.trim()
  };
  const ex=list.find(x=>x.id===data.id);
  if(ex){ list.splice(list.indexOf(ex),1,data); } else { list.push(data); }
  save(KEY.ITEMS,items);
  renderTab(CURRENT_TAB);
  closeModal();
}
function quickDelete(id,tab){
  const items=load(KEY.ITEMS,{home:[],tab2:[],tab3:[]});
  items[tab]=items[tab].filter(x=>x.id!==id);
  save(KEY.ITEMS,items);
  renderTab(tab);
}
function deleteItem(){
  if(!EDITING_ID) return;
  quickDelete(EDITING_ID,CURRENT_TAB);
  closeModal();
}

/* ========= Config (branding / enlaces / HTML) ========= */
async function applyBranding(){
  const c=load(KEY.CFG,{});
  c.name=byId('cfg_name').value.trim();
  c.sub =byId('cfg_sub').value.trim();
  c.primary=byId('cfg_primary').value;
  c.accent =byId('cfg_accent').value;
  const f=byId('cfg_logo').files?.[0];
  if(f) c.logo=await fileToDataURL(f);
  save(KEY.CFG,c);
  applyBrand();
  alert('Branding aplicado');
}
function applyLinks(){
  const c=load(KEY.CFG,{});
  c.fb=byId('cfg_fb').value.trim();
  c.ig=byId('cfg_ig').value.trim();
  c.waPhone=byId('cfg_wa').value.trim();
  c.waText =byId('cfg_wa_text').value.trim();
  save(KEY.CFG,c);
  alert('Enlaces aplicados');
}
function applyHtml(){
  const c=load(KEY.CFG,{});
  c.htmlHome=byId('cfg_html_home').value;
  c.htmlTab2=byId('cfg_html_tab2').value;
  c.htmlTab3=byId('cfg_html_tab3').value;
  save(KEY.CFG,c);
  renderAll();
  alert('HTML aplicado');
}

/* ========= Exportar PDF (Imprimir) ========= */
function exportSectionPDF(sectionId,title='Exportación'){
  const node=byId(sectionId);
  const html = `
  <html><head><meta charset="utf-8"><title>${title}</title>
  <style>
    body{font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial;padding:20px}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
    .card{border:1px solid #ddd;border-radius:12px;padding:12px}
    img{max-width:100%;height:auto;border-radius:10px}
    .price{display:inline-block;border:1px solid #ddd;border-radius:8px;padding:2px 8px;margin:4px 0}
  </style>
  </head><body>${node.innerHTML}</body></html>`;
  const w=window.open('','_blank'); w.document.write(html); w.document.close(); w.focus(); w.print();
}

/* ========= Login admin ========= */
function toggleAdminUI(){
  const on=isAdmin();
  ['btnAddItemHome','btnAddItemTab2','btnAddItemTab3'].forEach(id=>{
    const el=byId(id); if(el) el.classList.toggle('hidden',!on);
  });
  byId('btnLogin').classList.toggle('hidden',on);
  byId('btnLogout').classList.toggle('hidden',!on);
}
function doLogin(){
  const u=prompt('Usuario (admin)')||'';
  const p=prompt('Contraseña')||'';
  if(u==='admin' && p==='admin123'){
    save(KEY.SESSION,{user:'admin',ts:Date.now()});
    toggleAdminUI();
    alert('Bienvenido, admin');
  }else{
    alert('Credenciales inválidas');
  }
}
function doLogout(){
  localStorage.removeItem(KEY.SESSION);
  toggleAdminUI();
}

/* ========= Bind UI ========= */
function bindUI(){
  // Tabs
  $$('.tab').forEach(a=> a.addEventListener('click',()=> show(a.dataset.goto)));

  // Botones de añadir
  byId('btnAddItemHome').addEventListener('click',()=>{CURRENT_TAB='home';openModal();});
  byId('btnAddItemTab2').addEventListener('click',()=>{CURRENT_TAB='tab2';openModal();});
  byId('btnAddItemTab3').addEventListener('click',()=>{CURRENT_TAB='tab3';openModal();});

  // Modal
  byId('btnCloseModal').addEventListener('click',closeModal);
  byId('btnSaveItem').addEventListener('click',saveItem);
  byId('btnDeleteItem').addEventListener('click',deleteItem);

  // Config aplicar
  byId('btnApplyBrand').addEventListener('click',applyBranding);
  byId('btnApplyLinks').addEventListener('click',applyLinks);
  byId('btnApplyHtml').addEventListener('click',applyHtml);

  // Exportar PDF
  byId('btnExportPDFHome').addEventListener('click',()=>exportSectionPDF('screen-home','Catálogo'));

  // Login
  byId('btnLogin').addEventListener('click',doLogin);
  byId('btnLogout').addEventListener('click',doLogout);
}

/* ========= Boot ========= */
function boot(){
  ensureDefaults();
  applyBrand();
  renderAll();
  bindUI();
  toggleAdminUI(); // oculta/activa botones según sesión
  // Cargar campos de config (solo visual — no bloquea nada si están vacíos)
  const c=load(KEY.CFG,{});
  byId('cfg_name').value=c.name||'';
  byId('cfg_sub').value=c.sub||'';
  byId('cfg_primary').value=c.primary||'#5df0c1';
  byId('cfg_accent').value=c.accent||'#7aa5ff';
  byId('cfg_fb').value=c.fb||'';
  byId('cfg_ig').value=c.ig||'';
  byId('cfg_wa').value=c.waPhone||'';
  byId('cfg_wa_text').value=c.waText||'';
  byId('cfg_html_home').value=c.htmlHome||'';
  byId('cfg_html_tab2').value=c.htmlTab2||'';
  byId('cfg_html_tab3').value=c.htmlTab3||'';
}
document.addEventListener('DOMContentLoaded',boot);

/* Exponer helpers usados en HTML inline */
window.openModal=openModal;
window.quickDelete=quickDelete;
</script>
